local shopsPos <const> = {
    ["Echipament Medical"] = {
        coords = {
            vector3(306.10531616211,-597.52618408203,43.284030914307),  
        },
        blipid = 68,
    },

    ["Echipament Sindicat"] = {
        coords = {
            vector3(-97.862739562988,820.99700927734,227.88105773926),  
        },
        blipid = 68,
    },

    ["Echipament Politie"] = {
        coords = {
            vector3(482.52334594727,-995.62036132812,30.689653396606),   
        },
        blipid = 0,
    },

    ["Politie"] = {
        coords = {
            vector3(487.04699707031,-996.62927246094,30.689651489258),   
        },
        blipid = 0,
    },

    ["Diicot"] = {
        coords = {
            vector3(362.7982, -1603.5060, 25.4517),   
        },
        blipid = 0,
    },

    ["Echipament Mecanic"] = {
        coords = {
            vector3(1684.1549072266,6441.0581054688,32.786808013916),  
            vector3(1705.0814208984,6435.689453125,32.7913169860842),
            vector3(1153.8054199219,-780.93780517578,57.598747253418),
        },
        blipid = 446,
    },

    ["Alimentar"] = {
        coords = {
            vector3(25.99, -1347.71, 29.5),
            vector3(1729.12, 6414.13, 35.04),
            vector3(-48.7, -1757.75, 29.42),
            vector3(-1222.59, -906.63, 12.33),
            vector3(-707.61, -914.76, 19.22),
            vector3(1136.16, -982.69, 46.42),
            vector3(1163.23, -324.07, 69.21),
            vector3(2557.74, 382.34, 108.62),
            vector3(-3039.01, 586.24, 7.91),
            vector3(-3241.65, 100.1, 12.83),
            vector3(-2968.29, 391.17, 15.04),
            vector3(-1820.62, 792.32, 138.12),
            vector3(547.43, 2671.63, 42.16),
            vector3(1165.65, 2708.97, 38.16),
            vector3(2679.31, 3280.61, 55.24),
            vector3(1961.81, 3740.42, 32.34),
            vector3(1392.24, 3604.49, 34.98),
            vector3(1698.08, 4924.88, 42.06),
            vector3(1729.17, 6414.04, 35.04),
            vector3(123.56120300293, -1035.3743896484, 29.277151107788),
            vector3(131.54862976074, -1053.3599853516, 22.960254669189),
        },
        blipid = 52,
        blipcolor = 2,
    },

    ["Normal"] = {
        coords = {
            vector3(843.41326904296,-1033.5826416016,28.194860458374),
            vector3(252.50219726562,-49.00774383545,69.941078186036),
            vector3(811.21942138672,-2157.1469726562,29.619012832642),
            vector3(-663.18841552734,-935.29486083984,21.829221725464),
            vector3(-1305.599975586,-393.20083618164,36.69577407837),
            vector3(21.147958755493,-1106.3408203125,29.797012329102),
            vector3(-331.6579284668,6082.392578125,31.454763412476),
            vector3(-3172.6442871094,1085.9375,20.838750839233),
            vector3(-1119.3117675781,2697.291015625,18.554153442383),
            vector3(1692.2591552734,3758.3828125,34.705341339111),
            vector3(2569.7927246094,294.38684082031,108.73487091064),
        },
        blipid = 110,
    },

    ["Blackmarket Los Vagos"] = {
        coords = {
            vector3(-1026.1376953125,360.69595336914,71.36149597168),
        },
        blipid = 0,
    },

    ["Blackmarket Siciliana"] = {
        coords = {
            vector3(1557.6135253906,2176.3208007812,78.775802612305),
        },
        blipid = 0,
    },

    ["Blackmarket Mafia Camorra"] = {
        coords = {
            vector3(-1476.5244140625,-37.938980102539,54.607181549072),
        },
        blipid = 0,
    },

    ["Blackmarket Mafia Nortenos"] = {
        coords = {
            vector3(-1512.6203613281,845.23815917969,177.00006103516),
        },
        blipid = 0,
    },


    ["Blackmarket Ballas"] = {
        coords = {
            vector3(1394.9108886719,1141.8343505859,114.62352752686),
        },
        blipid = 0,
    },

    ["Blackmarket Mafia Astro"] = {
        coords = {
            vector3(-3200.0815429688,841.02740478516,8.9284362792969),
        },
        blipid = 0,
    },

    ["Blackmarket Mafia Yakuza"] = {
        coords = {
            vector3(789.15356445312,3405.53515625,57.884212493896),
        },
        blipid = 0,
    },

    ["Blackmarket Crips"] = {
        coords = {
            vector3(506.02975463867,-2756.1401367188,3.0706148147583),
        },
        blipid = 0,
    },
    
    ["Blackmarket Mafia OTF"] = {
        coords = {
            vector3(-85.379959106445,996.04864501953,230.6721496582),
        },
        blipid = 0,
    },

    ["Blackmarket Sons of Anarchy"] = {
        coords = {
            vector3(983.46545410156,-125.56377410889,78.889945983887),
        },
        blipid = 0,
    },

    ["Sindicat"] = {
        coords = {
            vector3(-101.21969604492,823.44805908203,227.88108825684),  
        },
        blipid = 110,
    },

    ["Blackmarket Merryweather Security"] = {
        coords = {
          vector3(-95.361434936523, 829.52935791016, 227.88108825684),  
        },
        blipid = 110,
    },
    
    ["Mega Mall"] = {
        coords = {
            vector3(46.475021362305,-1749.5883789063,29.634954452515),  
        },
        blipid = 0,
    },

    ["Produse Black-Market"] = {
        coords = {
            vector3(1396.8568115234,3605.0075683594,38.941909790039),  
        },
        blipid = 0,
    },

    ["Magazin Set Chimie"] = {
        coords = {
            vector3(-264.13201904297,2196.4829101563,130.39877319336),  
        },
        blipid = 0,
    },

    ["Magazin Bar"] = {
        coords = {
            vector3(-1133.4019775391,-1717.8361816406,5.3441114425659),  
            vector3(-3224.451171875,802.03509521484,8.9276304244995),
        },
        blipid = 0,
    },


    ["Farmacie"] = {
        coords = {
            vector3(312.35784912109,-592.95141601563,43.283981323242),  
        },
        blipid = 0,
    },

    ["Pacific"] = {
        coords = {
            vector3(5262.3623046875,-5434.6381835938,65.597274780273),  
        },
        blipid = 0,
    },

    ["Biju"] = {
        coords = {
            vector3(4959.1572265625,-5101.4848632812,3.239474773407),  
        },
        blipid = 0,
    },

    ["Magazin de Tigari"] = {
        coords = {
            vector3(-332.96264648438,57.060924530029,54.429843902588),  
        },
        blipid = 0,
    },

    ["Magazin Carduri"] = {
        coords = {
            vector3(414.01257324219, -1508.6011962891, 29.291595458984),  
        },
        blipid = 0,
    }
}

RegisterNUICallback("Markets24_Buy", function(data, cb)
    TriggerServerEvent("rush:buyFromMarket", data.basket, data.marketName)
    cb("ok")
end)

RegisterNetEvent("rush:emptyMarketBasket", function()
    SendNUIMessage({type = "emptyMarkets24Basket"})
end)

Citizen.CreateThread(function()
    for marketName in pairs(shopsPos) do

        if shopsPos[marketName].blipid and shopsPos[marketName].blipid ~= 0 then

            for _, pos in pairs(shopsPos[marketName].coords) do
                local blip = AddBlipForCoord(pos)
                SetBlipSprite(blip, shopsPos[marketName].blipid)
                if shopsPos[marketName].blipcolor then
                    SetBlipColour(blip, shopsPos[marketName].blipcolor)
                end
                SetBlipScale(blip, 0.8)
                SetBlipAsShortRange(blip, true)
                BeginTextCommandSetBlipName("STRING")
                AddTextComponentString(marketName)
                EndTextCommandSetBlipName(blip)
            end

        end
    end

    while true do
        if IsPedInAnyVehicle(myPed) then
            Citizen.Wait(2000)
        else

            local nearAny = false

            for marketName, marketData in pairs(shopsPos) do
                for _, pos in pairs(marketData.coords) do
                    local dst = #(myPos - pos)

                    if dst <= 5.0 then
                        nearAny = true
                        
                        local text = "Magazin: ~g~"..marketName

                        if dst <= 1.5 then
                            text = "[E] "..text

                            if IsControlJustReleased(0, 38) then
                                local p = promise:new()
                                triggerCallback("getMarketData", function(res)
                                    p:resolve(res)
                                end, marketName)

                                local shopData = Citizen.Await(p)

                                if not shopData then
                                    TriggerEvent("rush:notify", "Nu poti deschide acest magazin")
                                else
                                    SendNUIMessage({type = "showMarkets24", name = marketName, products = shopData.products, categories = shopData.categories})
                                end
                            end
                        end

                        DrawText3D(pos, text)
                    end
                end
            end


            if not nearAny then
                Citizen.Wait(1000)
            end
        
            Citizen.Wait(1)
        end
    end
end)